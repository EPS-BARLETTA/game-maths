<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Jeu de Maths</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: #222;
      color: white;
      margin: 0;
      padding: 20px;
    }
    .button {
      padding: 12px 25px;
      margin: 10px;
      background: #4CAF50;
      border: none;
      border-radius: 10px;
      color: white;
      cursor: pointer;
      font-size: 1.1em;
    }
    input {
      padding: 10px;
      border-radius: 8px;
      border: none;
      font-size: 1.1em;
      margin: 10px;
    }
    #question {
      font-size: 2.2em;
      margin-top: 20px;
    }
  </style>
</head>
<body>

<h1>ðŸŽ® Jeu de Maths</h1>

<!-- Ã‰CRAN D'ACCUEIL -->
<div id="start">
  <p>PrÃ©nom : <input id="prenom"></p>
  <p>Classe : <input id="classe"></p>

  <h3>Choisir un mode :</h3>
  <button class="button" onclick="startGame('multiplication')">Multiplications</button>
  <button class="button" onclick="startGame('addition')">Additions</button>
  <button class="button" onclick="startGame('chrono')">Calcul Chrono</button>
</div>

<!-- Ã‰CRAN DE JEU -->
<div id="game" style="display:none;">
  <div id="question"></div>
  <input id="answer" autofocus>
  <br>
  <button class="button" onclick="submitAnswer()">Valider</button>

  <p id="progress" style="margin-top:20px; font-size:1.3em;"></p>
</div>

<!-- Ã‰CRAN DE RESULTATS -->
<div id="result" style="display:none;">
  <h2>RÃ©sultat</h2>
  <p id="scoreText" style="font-size:1.6em;"></p>
  <p id="advice" style="font-size:1.3em; margin-bottom:20px;"></p>

  <canvas id="qr"></canvas>
</div>

<script>

let mode, prenom, classe;
let currentQuestion, correctAnswer;
let questionCount = 0;
let correctCount = 0;
let mistakes = {};  // stocke erreurs par table

function startGame(selectedMode) {
  prenom = document.getElementById("prenom").value;
  classe = document.getElementById("classe").value;
  mode = selectedMode;

  if (!prenom || !classe) {
    alert("Merci dâ€™entrer un prÃ©nom et une classe.");
    return;
  }

  document.getElementById("start").style.display = "none";
  document.getElementById("game").style.display = "block";

  nextQuestion();
}

function nextQuestion() {
  questionCount++;
  if (questionCount > 10) {
    finishGame();
    return;
  }

  let a = Math.floor(Math.random() * 9) + 1;
  let b = Math.floor(Math.random() * 9) + 1;

  if (mode === "multiplication") {
    currentQuestion = `${a} Ã— ${b}`;
    correctAnswer = a * b;

    if (!mistakes[`table_${a}`]) mistakes[`table_${a}`] = 0;
    if (!mistakes[`table_${b}`]) mistakes[`table_${b}`] = 0;
  }

  if (mode === "addition" || mode === "chrono") {
    currentQuestion = `${a} + ${b}`;
    correctAnswer = a + b;
  }

  document.getElementById("question").textContent = currentQuestion;
  document.getElementById("progress").textContent = `${questionCount}/10`;

  document.getElementById("answer").value = "";
}

function submitAnswer() {
  let ans = parseInt(document.getElementById("answer").value);

  if (ans === correctAnswer) {
    correctCount++;
  } else {
    if (mode === "multiplication") {
      let parts = currentQuestion.split("Ã—");
      mistakes[`table_${parseInt(parts[0])}`]++;
      mistakes[`table_${parseInt(parts[1])}`]++;
    }
  }

  nextQuestion();
}

function finishGame() {
  document.getElementById("game").style.display = "none";
  document.getElementById("result").style.display = "block";

  let worst = null;
  let maxErrors = 0;

  for (let table in mistakes) {
    if (mistakes[table] > maxErrors) {
      maxErrors = mistakes[table];
      worst = table;
    }
  }

  let adviceMsg = (worst && maxErrors > 0)
    ? `Travaille la ${worst.replace("table_", "table de ")}`
    : "TrÃ¨s bon travail !";

  document.getElementById("advice").textContent = adviceMsg;

  let score = `${correctCount}/10`;
  document.getElementById("scoreText").textContent = "Score : " + score;

  let data = {
    prenom: prenom,
    classe: classe,
    mode: mode,
    score: score,
    erreurs: mistakes,
    conseil: adviceMsg
  };

  new QRious({
    element: document.getElementById("qr"),
    size: 260,
    value: JSON.stringify(data)
  });
}

</script>

</body>
</html>
